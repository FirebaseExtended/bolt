"use strict";
var chai = require('chai');
var assert = chai.assert;
var helper = require('./test-helper');
var proc = require('child_process');
var fs = require('fs');
var Promise = require('promise');
var TMP_DIR = 'tmp/';
suite("firebase-bolt CLI", function () {
    suiteSetup(function () {
        try {
            fs.mkdirSync(TMP_DIR);
        }
        catch (e) {
        }
    });
    var tests = [
        { data: "--help",
            expect: { out: /^$/, err: /helpful message/ } },
        { data: "--h",
            expect: { out: /^$/, err: /helpful message/ } },
        { data: "--version",
            expect: { out: /^Firebase Bolt v\d+\.\d+\.\d+\n$/, err: /^$/ } },
        { data: "--v",
            expect: { out: /^Firebase Bolt v\d+\.\d+\.\d+\n$/, err: /^$/ } },
        { label: "stdin -> stdout",
            data: { stdin: "path / is String;" },
            expect: { out: /newData\.isString/, err: /^$/ } },
        { label: "stdin -> file",
            data: { stdin: "path / is String;", args: "--o " + TMP_DIR + "test" },
            expect: { out: /^$/, err: new RegExp("^bolt: Generating " + TMP_DIR + "test") } },
        { data: "samples/all_access",
            expect: { out: /^$/, err: /^bolt: Generating samples\/all_access.json\.\.\.\n$/ } },
        { data: "samples/all_access.bolt",
            expect: { out: /^$/, err: /^bolt: Generating samples\/all_access.json\.\.\.\n$/ } },
        { data: "samples/all_access --output " + TMP_DIR + "all_access",
            expect: { out: /^$/, err: new RegExp("^bolt: Generating " + TMP_DIR + "all_access.json\\.\\.\\.\\n$") } },
        { data: "samples/all_access.json",
            expect: { out: /^$/, err: /bolt: Cannot overwrite/ } },
        { data: "--output",
            expect: { out: /^$/, err: /^bolt: Missing output file name/ } },
        { data: "nosuchfile",
            expect: { out: /^$/, err: /bolt: Could not read file: nosuchfile.bolt/ } },
        { data: "two files",
            expect: { out: /^$/, err: /bolt: Can only compile a single file/ } },
    ];
    helper.dataDrivenTest(tests, function (data, expect) {
        return new Promise(function (resolve, reject) {
            var args;
            if (typeof (data) === 'string') {
                args = data;
            }
            else {
                args = data.args || '';
            }
            var child = proc.exec('bin/firebase-bolt ' + args, function (error, stdout, stderr) {
                if (expect.err) {
                    assert.isTrue(expect.err.test(stderr), "Unexpected message: '" + stderr + "'");
                }
                if (expect.out) {
                    assert.isTrue(expect.out.test(stdout), "Unexpected output: '" + stdout + "'");
                }
                resolve();
            });
            if (data.stdin) {
                child.stdin.write(data.stdin);
                child.stdin.end();
            }
        });
    });
});

//# sourceMappingURL=data:application/json;base64,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LEdBQUcsQ0FBQyxDQUFDO2dCQUNoRixDQUFDO2dCQUNELE9BQU8sRUFBRSxDQUFDO1lBQ1osQ0FBQyxDQUFDLENBQUM7WUFDSCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDZixLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQzlCLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDcEIsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2NsaS10ZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQ29weXJpZ2h0IDIwMTUgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5pbXBvcnQgY2hhaSA9IHJlcXVpcmUoJ2NoYWknKTtcclxudmFyIGFzc2VydCA9IGNoYWkuYXNzZXJ0O1xyXG5pbXBvcnQgaGVscGVyID0gcmVxdWlyZSgnLi90ZXN0LWhlbHBlcicpO1xyXG5pbXBvcnQgcHJvYyA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKTtcclxuaW1wb3J0IGZzID0gcmVxdWlyZSgnZnMnKTtcclxuaW1wb3J0IFByb21pc2UgPSByZXF1aXJlKCdwcm9taXNlJyk7XHJcblxyXG52YXIgVE1QX0RJUiA9ICd0bXAvJztcclxuXHJcbnN1aXRlKFwiZmlyZWJhc2UtYm9sdCBDTElcIiwgZnVuY3Rpb24oKSB7XHJcbiAgc3VpdGVTZXR1cCgoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBmcy5ta2RpclN5bmMoVE1QX0RJUik7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIC8vIGRvIG5vdGhpbmdcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgdmFyIHRlc3RzID0gW1xyXG4gICAgLy8gU2ltcGxlIG9wdGlvbnMgdGVzdHMuXHJcbiAgICB7IGRhdGE6IFwiLS1oZWxwXCIsXHJcbiAgICAgIGV4cGVjdDoge291dDogL14kLywgZXJyOiAvaGVscGZ1bCBtZXNzYWdlL30gfSxcclxuICAgIHsgZGF0YTogXCItLWhcIixcclxuICAgICAgZXhwZWN0OiB7b3V0OiAvXiQvLCBlcnI6IC9oZWxwZnVsIG1lc3NhZ2UvfSB9LFxyXG4gICAgeyBkYXRhOiBcIi0tdmVyc2lvblwiLFxyXG4gICAgICBleHBlY3Q6IHtvdXQ6IC9eRmlyZWJhc2UgQm9sdCB2XFxkK1xcLlxcZCtcXC5cXGQrXFxuJC8sIGVycjogL14kL30gfSxcclxuICAgIHsgZGF0YTogXCItLXZcIixcclxuICAgICAgZXhwZWN0OiB7b3V0OiAvXkZpcmViYXNlIEJvbHQgdlxcZCtcXC5cXGQrXFwuXFxkK1xcbiQvLCBlcnI6IC9eJC99IH0sXHJcblxyXG4gICAgLy8gUmVhZGluZyBmcm9tIHN0ZGluXHJcbiAgICB7IGxhYmVsOiBcInN0ZGluIC0+IHN0ZG91dFwiLFxyXG4gICAgICBkYXRhOiB7IHN0ZGluOiBcInBhdGggLyBpcyBTdHJpbmc7XCIgfSxcclxuICAgICAgZXhwZWN0OiB7b3V0OiAvbmV3RGF0YVxcLmlzU3RyaW5nLywgZXJyOiAvXiQvfSB9LFxyXG4gICAgeyBsYWJlbDogXCJzdGRpbiAtPiBmaWxlXCIsXHJcbiAgICAgIGRhdGE6IHsgc3RkaW46IFwicGF0aCAvIGlzIFN0cmluZztcIiwgYXJnczogXCItLW8gXCIgKyBUTVBfRElSICsgXCJ0ZXN0XCIgfSxcclxuICAgICAgZXhwZWN0OiB7b3V0OiAvXiQvLCBlcnI6IG5ldyBSZWdFeHAoXCJeYm9sdDogR2VuZXJhdGluZyBcIiArIFRNUF9ESVIgKyBcInRlc3RcIil9IH0sXHJcblxyXG4gICAgLy8gUmVhZGluZyBmcm9tIGEgZmlsZVxyXG4gICAgeyBkYXRhOiBcInNhbXBsZXMvYWxsX2FjY2Vzc1wiLFxyXG4gICAgICBleHBlY3Q6IHtvdXQ6IC9eJC8sIGVycjogL15ib2x0OiBHZW5lcmF0aW5nIHNhbXBsZXNcXC9hbGxfYWNjZXNzLmpzb25cXC5cXC5cXC5cXG4kL30gfSxcclxuICAgIHsgZGF0YTogXCJzYW1wbGVzL2FsbF9hY2Nlc3MuYm9sdFwiLFxyXG4gICAgICBleHBlY3Q6IHtvdXQ6IC9eJC8sIGVycjogL15ib2x0OiBHZW5lcmF0aW5nIHNhbXBsZXNcXC9hbGxfYWNjZXNzLmpzb25cXC5cXC5cXC5cXG4kL30gfSxcclxuICAgIHsgZGF0YTogXCJzYW1wbGVzL2FsbF9hY2Nlc3MgLS1vdXRwdXQgXCIgKyBUTVBfRElSICsgXCJhbGxfYWNjZXNzXCIsXHJcbiAgICAgIGV4cGVjdDoge291dDogL14kLywgZXJyOiBuZXcgUmVnRXhwKFwiXmJvbHQ6IEdlbmVyYXRpbmcgXCIgKyBUTVBfRElSICsgXCJhbGxfYWNjZXNzLmpzb25cXFxcLlxcXFwuXFxcXC5cXFxcbiRcIil9IH0sXHJcbiAgICB7IGRhdGE6IFwic2FtcGxlcy9hbGxfYWNjZXNzLmpzb25cIixcclxuICAgICAgZXhwZWN0OiB7b3V0OiAvXiQvLCBlcnI6IC9ib2x0OiBDYW5ub3Qgb3ZlcndyaXRlL30gfSxcclxuXHJcbiAgICAvLyBBcmd1bWVudCBlcnJvcnNcclxuICAgIHsgZGF0YTogXCItLW91dHB1dFwiLFxyXG4gICAgICBleHBlY3Q6IHtvdXQ6IC9eJC8sIGVycjogL15ib2x0OiBNaXNzaW5nIG91dHB1dCBmaWxlIG5hbWUvfSB9LFxyXG4gICAgeyBkYXRhOiBcIm5vc3VjaGZpbGVcIixcclxuICAgICAgZXhwZWN0OiB7b3V0OiAvXiQvLCBlcnI6IC9ib2x0OiBDb3VsZCBub3QgcmVhZCBmaWxlOiBub3N1Y2hmaWxlLmJvbHQvfSB9LFxyXG4gICAgeyBkYXRhOiBcInR3byBmaWxlc1wiLFxyXG4gICAgICBleHBlY3Q6IHtvdXQ6IC9eJC8sIGVycjogL2JvbHQ6IENhbiBvbmx5IGNvbXBpbGUgYSBzaW5nbGUgZmlsZS99IH0sXHJcbiAgXTtcclxuXHJcbiAgaGVscGVyLmRhdGFEcml2ZW5UZXN0KHRlc3RzLCBmdW5jdGlvbihkYXRhLCBleHBlY3QpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgbGV0IGFyZ3M6IHN0cmluZztcclxuXHJcbiAgICAgIGlmICh0eXBlb2YoZGF0YSkgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgYXJncyA9IGRhdGE7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYXJncyA9IGRhdGEuYXJncyB8fCAnJztcclxuICAgICAgfVxyXG4gICAgICBsZXQgY2hpbGQgPSBwcm9jLmV4ZWMoJ2Jpbi9maXJlYmFzZS1ib2x0ICcgKyBhcmdzLCBmdW5jdGlvbihlcnJvciwgc3Rkb3V0LCBzdGRlcnIpIHtcclxuICAgICAgICBpZiAoZXhwZWN0LmVycikge1xyXG4gICAgICAgICAgYXNzZXJ0LmlzVHJ1ZShleHBlY3QuZXJyLnRlc3Qoc3RkZXJyKSwgXCJVbmV4cGVjdGVkIG1lc3NhZ2U6ICdcIiArIHN0ZGVyciArIFwiJ1wiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGV4cGVjdC5vdXQpIHtcclxuICAgICAgICAgIGFzc2VydC5pc1RydWUoZXhwZWN0Lm91dC50ZXN0KHN0ZG91dCksIFwiVW5leHBlY3RlZCBvdXRwdXQ6ICdcIiArIHN0ZG91dCArIFwiJ1wiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9KTtcclxuICAgICAgaWYgKGRhdGEuc3RkaW4pIHtcclxuICAgICAgICBjaGlsZC5zdGRpbi53cml0ZShkYXRhLnN0ZGluKTtcclxuICAgICAgICBjaGlsZC5zdGRpbi5lbmQoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
